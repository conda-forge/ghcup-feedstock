{% set name = "ghcup" %}
{% set version = "0.1.19.3" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://downloads.haskell.org/~ghcup/{{ version }}/aarch64-apple-darwin-ghcup-{{ version }}  # [osx and arm64]
  sha256: 012120fc671a4133dad89b8a08a9a9b6a67ac2eb7c6bda219a63fbfce7df3d6e  # [osx and arm64]
  url: https://downloads.haskell.org/~ghcup/{{ version }}/aarch64-linux-ghcup-{{ version }}  # [linux and aarch64]
  sha256: 0ef062d46916c11cae1088e15ba7aa79897b0b43cb7fdbaca627f04b53eaa61d  # [linux and aarch64]
  url: https://downloads.haskell.org/~ghcup/{{ version }}/x86_64-apple-darwin-ghcup-{{ version }}  # [osx and x86_64]
  sha256: 448916a07b4acc04e2e5d8f1aa44554e457ee0a6f093b732fd9992393a56c040  # [osx and x86_64]
  url: https://downloads.haskell.org/~ghcup/{{ version }}/x86_64-linux-ghcup-{{ version }}  # [linux and x86_64]
  sha256: fc9bf8acfbfba519ae3c6f6533c559332f0661900eaa8903ca073f2f97471230  # [linux and x86_64]
  url: https://downloads.haskell.org/~ghcup/{{ version }}/x86_64-mingw64-ghcup-{{ version }}.exe  # [win]
  sha256: e3f632eb6dc203f022138a97463b24985c4fb2e8038bb671fdafc850c71f70b0  # [win]
  fn: ghcup  # [not win]
  fn: ghcup.exe  # [win]

build:
  number: 0
  binary_relocation: false

requirements:
  run:
    - curl

test:
  commands:
    - ghcup -h
    - if [ "$GHCUP_INSTALL_BASE_PREFIX" != "$PREFIX" ]; then echo "GHCUP_INSTALL_BASE_PREFIX var not set correctly" && exit 1; fi    # [unix]
    - if [ "$GHCUP_SKIP_UPDATE_CHECK" != "1" ]; then echo "GHCUP_SKIP_UPDATE_CHECK var not set correctly" && exit 1; fi    # [unix]
    - IF "%GHCUP_INSTALL_BASE_PREFIX:/=\%" NEQ "%LIBRARY_PREFIX%" exit 1    # [win]
    - IF "%GHCUP_SKIP_UPDATE_CHECK%" NEQ "1" exit 1    # [win]

about:
  home: https://gitlab.haskell.org/haskell/ghcup-hs
  summary: An installer for the general purpose language Haskell
  license: LGPL-3.0-only
  license_family: GPL
  license_file:
    - LICENSE.txt
    - dependency_licenses.txt

extra:
  recipe-maintainers:
    - msarahan
